<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>預約表單</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 500px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    form {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-bottom: 15px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    select {
      cursor: pointer;
    }
    button {
      width: 100%;
      padding: 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover {
      background: #45a049;
    }
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    #response {
      margin-top: 20px;
      padding: 15px;
      border-radius: 4px;
      display: none;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
  </style>
</head>
<body>
  <h2>預約時間表單</h2>
  <form id="bookingForm">
    <label>
      姓名:
      <input type="text" name="姓名" required>
    </label>

    <label>
      連絡電話:
      <input type="tel" name="連絡電話" required>
    </label>
    
    <label>
      之前是否來過本院:
      <select name="之前是否來過本院" required>
        <option value="">請選擇</option>
        <option value="有來過">有來過</option>
        <option value="第一次來">第一次來</option>
      </select>
    </label>
    
    <label>
      預約日期:
      <input type="date" name="預約日期" required>
    </label>
    
    <label>
      開始時間:
      <select name="開始時間" required>
        <option value="">請選擇開始時間</option>
        <option value="12:30">12:30</option>
        <option value="12:35">12:35</option>
        <option value="12:40">12:40</option>
        <option value="12:45">12:45</option>
        <option value="12:50">12:50</option>
        <option value="12:55">12:55</option>
        <option value="13:00">13:00</option>
        <option value="13:05">13:05</option>
        <option value="13:10">13:10</option>
        <option value="13:15">13:15</option>
        <option value="13:20">13:20</option>
        <option value="13:25">13:25</option>
        <option value="13:30">13:30</option>
        <option value="13:35">13:35</option>
        <option value="13:40">13:40</option>
        <option value="13:45">13:45</option>
        <option value="13:50">13:50</option>
        <option value="13:55">13:55</option>
        <option value="14:00">14:00</option>
        <option value="14:05">14:05</option>
        <option value="14:10">14:10</option>
        <option value="14:15">14:15</option>
        <option value="14:20">14:20</option>
        <option value="14:25">14:25</option>
        <option value="14:30">14:30</option>
        <option value="14:35">14:35</option>
        <option value="14:40">14:40</option>
        <option value="14:45">14:45</option>
        <option value="14:50">14:50</option>
        <option value="14:55">14:55</option>
        <option value="15:00">15:00</option>
        <option value="15:05">15:05</option>
        <option value="15:10">15:10</option>
        <option value="15:15">15:15</option>
        <option value="15:20">15:20</option>
        <option value="15:25">15:25</option>
        <option value="15:30">15:30</option>
        <option value="15:35">15:35</option>
        <option value="15:40">15:40</option>
        <option value="15:45">15:45</option>
        <option value="15:50">15:50</option>
        <option value="15:55">15:55</option>
        <option value="16:00">16:00</option>
        <option value="16:05">16:05</option>
        <option value="16:10">16:10</option>
        <option value="16:15">16:15</option>
        <option value="16:20">16:20</option>
        <option value="16:25">16:25</option>
        <option value="16:30">16:30</option>
        <option value="16:35">16:35</option>
        <option value="16:40">16:40</option>
        <option value="16:45">16:45</option>
        <option value="16:50">16:50</option>
        <option value="16:55">16:55</option>
        <option value="17:00">17:00</option>
        <option value="17:05">17:05</option>
        <option value="17:10">17:10</option>
        <option value="17:15">17:15</option>
        <option value="17:20">17:20</option>
        <option value="17:25">17:25</option>
        <option value="17:30">17:30</option>
        <option value="17:35">17:35</option>
        <option value="17:40">17:40</option>
        <option value="17:45">17:45</option>
        <option value="17:50">17:50</option>
        <option value="17:55">17:55</option>
        <option value="18:00">18:00</option>
        <option value="18:05">18:05</option>
        <option value="18:10">18:10</option>
        <option value="18:15">18:15</option>
        <option value="18:20">18:20</option>
        <option value="18:25">18:25</option>
        <option value="18:30">18:30</option>
        <option value="18:35">18:35</option>
        <option value="18:40">18:40</option>
        <option value="18:45">18:45</option>
        <option value="18:50">18:50</option>
        <option value="18:55">18:55</option>
        <option value="19:00">19:00</option>
        <option value="19:05">19:05</option>
        <option value="19:10">19:10</option>
        <option value="19:15">19:15</option>
        <option value="19:20">19:20</option>
        <option value="19:25">19:25</option>
        <option value="19:30">19:30</option>
        <option value="19:35">19:35</option>
        <option value="19:40">19:40</option>
        <option value="19:45">19:45</option>
        <option value="19:50">19:50</option>
        <option value="19:55">19:55</option>
        <option value="20:00">20:00</option>
        <option value="20:05">20:05</option>
        <option value="20:10">20:10</option>
        <option value="20:15">20:15</option>
        <option value="20:20">20:20</option>
        <option value="20:25">20:25</option>
        <option value="20:30">20:30</option>
        <option value="20:35">20:35</option>
        <option value="20:40">20:40</option>
        <option value="20:45">20:45</option>
        <option value="20:50">20:50</option>
        <option value="20:55">20:55</option>
        <option value="21:00">21:00</option>
        <option value="21:05">21:05</option>
        <option value="21:10">21:10</option>
        <option value="21:15">21:15</option>
        <option value="21:20">21:20</option>
        <option value="21:25">21:25</option>
        <option value="21:30">21:30</option>
      </select>
    </label>
    
    <label>
      分店:
      <select name="分店" id="branch" required>
        <option value="">請選擇分店</option>
        <option value="S01">S01（每周三、六、日公休）</option>
        <option value="S02">S02（每周一、三公休）</option>
      </select>
    </label>
    
    <label>
      服務項目:
      <select name="服務項目" id="service" required>
        <option value="">請選擇服務項目</option>
        <option value="諮詢">諮詢</option>
        <option value="淨膚雷射">淨膚雷射</option>
        <option value="飛梭">飛梭</option>
      </select>
    </label>
    
    <label>
      諮詢師:
      <select name="諮詢師" id="consultant" required>
        <option value="">請先選擇分店</option>
      </select>
    </label>
    
    <label>
      醫師:
      <select name="醫師" id="doctor" required>
        <option value="">請先選擇分店</option>
      </select>
    </label>
    
    <label>
      儀器:
      <select name="儀器" id="device" required>
        <option value="">請先選擇分店</option>
      </select>
    </label>
    
    <button type="submit">送出預約</button>
  </form>

  <div id="response"></div>

  <script>
    // 分店資料配置
    const branchData = {
      'S01': {
        consultants: ['C1', 'C2'],
        doctors: ['AAA', 'BBB', 'CCC'],
        devices: ['A01', 'B01', 'C01']
      },
      'S02': {
        consultants: ['C3', 'C4'],
        doctors: ['DDD', 'EEE'],
        devices: ['A02', 'B02']
      }
    };

    // 更新下拉選單
    function updateDropdown(selectId, options, placeholder) {
      const select = document.getElementById(selectId);
      select.innerHTML = '<option value="">' + placeholder + '</option>';
      options.forEach(opt => {
        const option = document.createElement('option');
        option.value = opt;
        option.textContent = opt;
        select.appendChild(option);
      });
    }

    // 監聽分店變更
    document.getElementById('branch').addEventListener('change', function() {
      const branch = this.value;
      if (branch && branchData[branch]) {
        updateDropdown('consultant', branchData[branch].consultants, '請選擇諮詢師');
        updateDropdown('doctor', branchData[branch].doctors, '請選擇醫師');
        updateDropdown('device', branchData[branch].devices, '請選擇儀器');
      } else {
        document.getElementById('consultant').innerHTML = '<option value="">請先選擇分店</option>';
        document.getElementById('doctor').innerHTML = '<option value="">請先選擇分店</option>';
        document.getElementById('device').innerHTML = '<option value="">請先選擇分店</option>';
      }
    });

    // 監聽服務項目變更
    document.getElementById('service').addEventListener('change', function() {
      const service = this.value;
      const doctorSelect = document.getElementById('doctor');
      const deviceSelect = document.getElementById('device');
      
      if (service === '諮詢') {
        // 禁用醫師選單
        doctorSelect.value = '';
        doctorSelect.disabled = true;
        doctorSelect.required = false;
        doctorSelect.style.backgroundColor = '#f0f0f0';
        doctorSelect.style.cursor = 'not-allowed';
        
        // 禁用儀器選單
        deviceSelect.value = '';
        deviceSelect.disabled = true;
        deviceSelect.required = false;
        deviceSelect.style.backgroundColor = '#f0f0f0';
        deviceSelect.style.cursor = 'not-allowed';
      } else {
        // 啟用醫師選單
        doctorSelect.disabled = false;
        doctorSelect.required = true;
        doctorSelect.style.backgroundColor = '';
        doctorSelect.style.cursor = 'pointer';
        
        // 啟用儀器選單
        deviceSelect.disabled = false;
        deviceSelect.required = true;
        deviceSelect.style.backgroundColor = '';
        deviceSelect.style.cursor = 'pointer';
        
        const branch = document.getElementById('branch').value;
        if (branch && branchData[branch]) {
          updateDropdown('doctor', branchData[branch].doctors, '請選擇醫師');
          updateDropdown('device', branchData[branch].devices, '請選擇儀器');
        } else {
          doctorSelect.innerHTML = '<option value="">請先選擇分店</option>';
          deviceSelect.innerHTML = '<option value="">請先選擇分店</option>';
        }
      }
    });

    document.getElementById('bookingForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitButton = e.target.querySelector('button[type="submit"]');
      
      submitButton.disabled = true;
      submitButton.textContent = '處理中...';
      
      const formData = new FormData(e.target);
      const data = {};
      formData.forEach((value, key) => {
        data[key] = value;
      });
      
      const responseDiv = document.getElementById('response');
      responseDiv.style.display = 'none';
      
      try {
        const response = await fetch('https://test0208.app.n8n.cloud/webhook-test/booking', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        responseDiv.className = response.ok ? 'success' : 'error';
        responseDiv.textContent = result.message || result;
        responseDiv.style.display = 'block';
        
        if (response.ok) {
          e.target.reset();
        }
      } catch (error) {
        console.log('Request failed:', error);
      } finally {
        setTimeout(() => {
          submitButton.disabled = false;
          submitButton.textContent = '送出預約';
        }, 2000);
      }
    });
  </script>
</body>
</html>